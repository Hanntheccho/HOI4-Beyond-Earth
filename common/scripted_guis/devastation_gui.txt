scripted_gui = {
	devastation_gui = {
		context_type = selected_state_context
		parent_window_token = selected_state_view
		
		window_name = "devastation_gui_window"
		
		visible = {
            always = yes
		}
		
		effects = {
			reduce_devastation_button_click = {
                if = {
                    limit = {
                        ROOT = {
                            has_country_flag = has_mind_tier3
                        }
                    }
                    THIS = {
                        decrease_devastation_more = yes
                        set_state_flag = {
                            flag = devastation_reduction_timeout_flag
                            value = 1
                            days = 30
                        }
                    }
                    ROOT = {
                        subtract_from_variable = { industrial_power = 40 }
                        subtract_from_variable = { current_devastation = 1 }
                    }
                }
                else_if = {
                    limit = {
                        ROOT = {
                            has_government = harmony
                        }
                    }
                    THIS = {
                        decrease_devastation = yes
                        set_state_flag = {
                            flag = devastation_reduction_timeout_flag
                            value = 1
                            days = 30
                        }
                    }
                    ROOT = {
                        subtract_from_variable = { industrial_power = 40 }
                        subtract_from_variable = { current_devastation = 1 }
                    }
                }
                else = {
                    THIS = {
                        decrease_devastation = yes
                        set_state_flag = {
                            flag = devastation_reduction_timeout_flag
                            value = 1
                            days = 60
                        }
                    }
                    ROOT = {
                        subtract_from_variable = { industrial_power = 25 }
		                subtract_from_variable = { current_devastation = 1 }
                    }
                }
			}
            reduce_devastation_button_mastery_click = {
                THIS = {
                    increase_devastation = yes
                    set_state_flag = {
                        flag = devastation_reduction_timeout_flag
                        value = 1
                        days = 60
                    }
                    add_extra_state_shared_building_slots = 1
				    add_building_construction = {
				    	type = industrial_complex
				    	level = 1
				    	instant_build = yes
				    }
                    add_building_construction = {
				    	type = infrastructure
				    	level = 1
				    	instant_build = yes
				    }
                    if = {
                        limit = {
                            has_resources_amount = {
                                resource = oil
                                amount > 0
                            }
                        }
                        add_resource = {
                            type = oil
                            amount = 10
                        }
                    }
                    if = {
                        limit = {
                            has_resources_amount = {
                                resource = rubber
                                amount > 0
                            }
                        }
                        add_resource = {
                            type = rubber
                            amount = 10
                        }
                    }
                    if = {
                        limit = {
                            has_resources_amount = {
                                resource = tungsten
                                amount > 0
                            }
                        }
                        add_resource = {
                            type = tungsten
                            amount = 10
                        }
                    }
                    if = {
                        limit = {
                            has_resources_amount = {
                                resource = chromium
                                amount > 0
                            }
                        }
                        add_resource = {
                            type = chromium
                            amount = 10
                        }
                    }
                    if = {
                        limit = {
                            has_resources_amount = {
                                resource = steel
                                amount > 0
                            }
                        }
                        add_resource = {
                            type = steel
                            amount = 10
                        }
                    }
                    if = {
                        limit = {
                            has_resources_amount = {
                                resource = aluminium
                                amount > 0
                            }
                        }
                        add_resource = {
                            type = aluminium
                            amount = 10
                        }
                    }
                }
                ROOT = {
                    subtract_from_variable = { industrial_power = 40 }
                    add_to_variable = { current_devastation = 1 }
                }
            }
		}
        triggers = {
            reduce_devastation_button_click_enabled = {
                if = {
                    limit = {
                        ROOT = {
                            has_country_flag = has_mind_tier3
                        }
                    }
                    THIS = {
                        OR = {
                            is_owned_by = ROOT
                            OWNER = { is_ally_with = ROOT }
                        }
                        OR = {
                            has_dynamic_modifier = {
                                modifier = minor_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = notable_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = major_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = significant_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = terminal_devastation
                            }
                        }
                        NOT = {
                            has_state_flag = devastation_reduction_timeout_flag
                        }
                    }
                    ROOT = { 
                        check_variable = {
                            var = industrial_power
                            value = 40
                            compare = greater_than_or_equals
                        }
                    }
                }
                else_if = {
                    limit = {
                        ROOT = {
                            has_government = harmony
                        }
                    }
                    THIS = {
                        OR = {
                            is_owned_by = ROOT
                            OWNER = { is_ally_with = ROOT }
                        }
                        OR = {
                            has_dynamic_modifier = {
                                modifier = notable_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = major_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = significant_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = terminal_devastation
                            }
                        }
                        NOT = {
                            has_state_flag = devastation_reduction_timeout_flag
                        }
                    }
                    ROOT = { 
                        check_variable = {
                            var = industrial_power
                            value = 40
                            compare = greater_than_or_equals
                        }
                    }
                }
                else = {
                    THIS = {
                        OR = {
                            is_owned_by = ROOT
                            OWNER = { is_ally_with = ROOT }
                        }
                        OR = {
                            has_dynamic_modifier = {
                                modifier = notable_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = major_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = significant_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = terminal_devastation
                            }
                        }
                        NOT = {
                            has_state_flag = devastation_reduction_timeout_flag
                        }
                        NOT = {
                            ROOT = {
                                has_idea = the_final_war_idea
                            }
                        }
                    }
                    ROOT = {
                        check_variable = {
                            var = industrial_power
                            value = 25
                            compare = greater_than_or_equals
                        }
                    }
                }
            }
            reduce_devastation_button_mastery_click_enabled = {
                THIS = {
                    OR = {
                        is_owned_by = ROOT
                        OWNER = { is_ally_with = ROOT }
                    }
                    OR = {
                        has_dynamic_modifier = {
                            modifier = no_devastation
                        }
                        has_dynamic_modifier = {
                            modifier = minor_devastation
                        }
                        has_dynamic_modifier = {
                            modifier = notable_devastation
                        }
                        has_dynamic_modifier = {
                            modifier = major_devastation
                        }
                        has_dynamic_modifier = {
                            modifier = significant_devastation
                        }
                    }
                    NOT = {
                        has_state_flag = devastation_reduction_timeout_flag
                    }
                }
                ROOT = {
                    check_variable = {
                        var = industrial_power
                        value = 40
                        compare = greater_than_or_equals
                    }
                }
            }
            reduce_devastation_button_mastery_visible = {
                ROOT = { 
                    has_country_flag = has_body_tier3
                }
            }
            reduce_devastation_load_click_enabled = {
                if = {
                    limit = {
                        ROOT = {
                            has_government = harmony
                            has_country_flag = has_mind_tier3
                        }
                    }
                    THIS = {
                        OR = {
                            is_owned_by = ROOT
                            OWNER = { is_ally_with = ROOT }
                        }
                        OR = {
                            has_dynamic_modifier = {
                                modifier = minor_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = notable_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = major_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = significant_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = terminal_devastation
                            }
                        }
                        NOT = {
                            has_state_flag = devastation_reduction_timeout_flag
                        }
                    }
                    ROOT = { 
                        check_variable = {
                            var = industrial_power
                            value = 40
                            compare = greater_than_or_equals
                        }
                    }
                }
                else_if = {
                    limit = {
                        ROOT = {
                            has_government = harmony
                        }
                    }
                    THIS = {
                        OR = {
                            is_owned_by = ROOT
                            OWNER = { is_ally_with = ROOT }
                        }
                        OR = {
                            has_dynamic_modifier = {
                                modifier = notable_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = major_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = significant_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = terminal_devastation
                            }
                        }
                        NOT = {
                            has_state_flag = devastation_reduction_timeout_flag
                        }
                    }
                    ROOT = { 
                        check_variable = {
                            var = industrial_power
                            value = 40
                            compare = greater_than_or_equals
                        }
                    }
                }
                else = {
                    THIS = {
                        OR = {
                            is_owned_by = ROOT
                            OWNER = { is_ally_with = ROOT }
                        }
                        OR = {
                            has_dynamic_modifier = {
                                modifier = notable_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = major_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = significant_devastation
                            }
                            has_dynamic_modifier = {
                                modifier = terminal_devastation
                            }
                        }
                        NOT = {
                            has_state_flag = devastation_reduction_timeout_flag
                        }
                        NOT = {
                            ROOT = {
                                has_idea = the_final_war_idea
                            }
                        }
                    }
                    ROOT = {
                        check_variable = {
                            var = industrial_power
                            value = 25
                            compare = greater_than_or_equals
                        }
                    }
                }
            }

            #
            no_devastation_icon_visible = {
                has_dynamic_modifier = {
                    modifier = no_devastation
                }
            }
            minor_devastation_icon_visible = {
                has_dynamic_modifier = {
                    modifier = minor_devastation
                }
            }
            notable_devastation_icon_visible = {
                has_dynamic_modifier = {
                    modifier = notable_devastation
                }
            }
            major_devastation_icon_visible = {
                has_dynamic_modifier = {
                    modifier = major_devastation
                }
            }
            significant_devastation_icon_visible = {
                has_dynamic_modifier = {
                    modifier = significant_devastation
                }
            }
            terminal_devastation_icon_visible = {
                has_dynamic_modifier = {
                    modifier = terminal_devastation
                }
            }
        }

        ai_enabled = {
            always = yes
        }

        ai_test_interval = 300

        ai_check = {
            check_variable = {
                industrial_power > 25
            }
		}

        ai_weights = {
            reduce_devastation_button_click = {
                ai_will_do = {
                    factor = 0
                    modifier = {
                        OWNER = {
                            check_variable = {
                                industrial_power > 500
                            }
                        }
                        add = 1000
			        }
                    modifier = {	
                        OWNER = {
                            has_idea = crumbling_society
                        }
                        add = 10000
			        }
                }
            }
            reduce_devastation_button_mastery_click = {
                ai_will_do = {
                    factor = 0
                    modifier = {
                        OWNER = {
                            check_variable = {
                                industrial_power > 500
                            }
                            NOT =  {
                                has_idea = crumbling_society
                            }
                        }
                        add = 100000
			        }
                }
            }
        }
	}
}
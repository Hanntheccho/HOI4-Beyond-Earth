on_actions = {
	on_capitulation_immediate = {
		effect = {
			ROOT = {
				every_owned_state = {
					limit = {
						is_core_of = FROM
						is_claimed_by = FROM
					}
					if = {
						limit = {
							root_is_minor_tag = yes
						}
						remove_core_of = ROOT
					}
					transfer_state_to = FROM
				}
			}
			FROM = {
				puppet = ROOT
			}
			puppet_government_too = yes
		}
	}
	###
	on_peaceconference_ended = { #FROM is looser, ROOT is winner
		effect = {
			if = {
				limit = {
					has_global_flag = final_war_flag
				}
				log = "A WAR HAS ENDED!"
			}
			#POL-LAT WAR
			else_if = {
				limit = {
					FROM = {
						tag = LAT
					}
					ROOT = {
						tag = POL
					}
				}
				POL = {
					end_puppet = LAT
				}
				GER = {
					add_to_faction = LAT
				}
				LAT = {
					set_politics = {
						ruling_party = harmony
					}
					retire_ideology_leader = harmony
					create_country_leader = {
						name = "INTEGR Committee"
						ideology = harmony_ideology
						picture = GFX_portrait_government_character_harmony
					}
					add_ideas = GER_german_aligned
				}
			}
			#KAR-SOV WAR
			else_if = {
				limit = {
					FROM = {
						tag = SOV
					}
					ROOT = {
						tag = KAR
					}
				}
				KAR = {
					country_event = { 
						id = karelia_event.5
						days = 0
					}
					country_event = { 
						id = karelia_event.6
						days = 25
					}
					SOV = {
						every_owned_state = {
							remove_core_of = SOV
							add_core_of = KAR
							transfer_state_to = KAR
						}
					}
					set_cosmetic_tag = KAR_russia
				}
			}
			#KAZ-URA WAR
			else_if = {
				limit = {
					FROM = {
						tag = URA
					}
					ROOT = {
						tag = KAZ
					}
				}
				URA = {
					set_cosmetic_tag = URA_democratic
				}
			}
			#DOS-CAS WAR
			else_if = {
				limit = {
					FROM = {
						tag = CAS
					}
					ROOT = {
						tag = DOS
					}
				}
				DOS = {
					every_owned_state = {
						limit = {
							is_core_of = CAS
						}
						remove_core_of = CAS
					}
					add_to_variable = {
						arc_legitimacy = 3
					}
				}
				ARC = {
					add_to_faction = DOS
				}
			}
			#CAS-DOS WAR
			else_if = {
				limit = {
					FROM = {
						tag = DOS
					}
					ROOT = {
						tag = CAS
					}
				}
				CAS = { #should make it so it tag switches player back to DOS
					every_owned_state = {
						remove_core_of = CAS
						transfer_state_to = DOS
					}
				}
				DOS = {
					add_to_variable = {
						nau_legitimacy = 3
					}
				}
				PNM = {
					add_to_faction = DOS
				}
			}
			#TRE-ONU WAR
			else_if = {
				limit = {
					FROM = {
						tag = ONU
					}
					ROOT = {
						tag = TRE
					}
				}
				TRE = {
					every_owned_state = {
						limit = {
							is_core_of = ONU
						}
						remove_core_of = ONU
					}
					add_to_variable = {
						arc_legitimacy = 3
					}
				}
				ARC = {
					add_to_faction = TRE
				}
			}
			#DOS-SIL WAR
			else_if = {
				limit = {
					FROM = {
						tag = SIL
					}
					ROOT = {
						tag = DOS
					}
				}
				DOS = {
					every_owned_state = {
						limit = {
							is_core_of = SIL
						}
						remove_core_of = SIL
					}
					add_to_variable = {
						arc_legitimacy = 3
					}
					set_capital = { #gives error if capital set to 12 in history file ;_;
						state = 12
						remember_old_capital = no
					}
				}
			}
			#ONE-CAL WAR
			else_if = {
				limit = {
					FROM = {
						tag = CAL
					}
					ROOT = {
						tag = ONE
					}
				}
				ONE = {
					annex_country = {
						target = CAL
					}
					every_owned_state = {
						limit = {
							is_core_of = CAL
						}
						remove_core_of = CAL
					}
					add_to_variable = {
						nau_legitimacy = 3
					}
				}
				PNM = {
					add_to_faction = ONE
				}
			}
			#TZN-COG WAR
			else_if = {
				limit = {
					FROM = {
						OR = {
							tag = COG
							tag = SAF
							tag = ANG
						}
						is_puppet_of = ROOT
					}
					ROOT = {
						tag = TZN
					}
				}
				FROM = {
					every_owned_state = {
						remove_core_of = FROM
						add_core_of = ROOT
						transfer_state_to = ROOT
					}
				}
				ROOT = {
					set_cosmetic_tag = TZN_AFRICA
				}
			}
			#GRP-BGV WAR
			else_if = {
				limit = {
					FROM = {
						OR = {
							tag = BGV
							original_tag = BGV
						}
					}
					ROOT = {
						tag = GRP
					}
				}
				FROM = {
					every_owned_state = {
						remove_core_of = FROM
						add_core_of = ROOT
						transfer_state_to = ROOT
					}
				}
				GRP = {
					set_cosmetic_tag = GRP_BRA
					declare_war_on = {
						target = LAM
						type = annex_puppet_wargoal
					}
				}
				PRU = {
					add_to_faction = GRP
					add_to_faction = URG
				}
			}
			#BGV-LEG WAR
			else_if = {
				limit = {
					FROM = {
						tag = LEG
					}
					ROOT = {
						tag = BGV
					}
				}
				FROM = {
					every_core_state = {
						remove_core_of = FROM
					}
				}
			}
			#PAD-ITA WAR
			else_if = {
				limit = {
					FROM = {
						tag = ITA
					}
					ROOT = {
						tag = PAD
					}
				}
				PAD = {
					set_cosmetic_tag = PAD_italy
					set_capital = {
						state = 334
						#remember_old_capital = no #?
					}
				}
			}
			#COS-ARG WAR
			else_if = {
				limit = {
					FROM = {
						tag = ARG
					}
					ROOT = {
						tag = COS
					}
				}
				FROM = {
					every_core_state = {
						remove_core_of = FROM
						add_core_of = ROOT
						transfer_state_to = ROOT
					}
				}
				ROOT = {
					set_cosmetic_tag = ARG_COS
					set_capital = {
						state = 154
						remember_old_capital = no
					}
				}
			}
			#ARG-COS WAR
			else_if = {
				limit = {
					FROM = {
						tag = COS
					}
					ROOT = {
						tag = ARG
					}
				}
				FROM = {
					every_core_state = {
						remove_core_of = FROM
						add_core_of = ROOT
						transfer_state_to = ROOT
					}
				}
				ROOT = {
					set_cosmetic_tag = ARG_ARG
				}
				PRU = { #SHOULD BE REMOVED FROM HERE SOMEHOW!
					add_to_faction = ARG
					add_to_faction = CHL
				}
			}
			#COS-CHL WAR
			else_if = {
				limit = {
					FROM = {
						tag = CHL
					}
					ROOT = {
						tag = COS
					}
				}
				FROM = {
					every_core_state = {
						#remove_core_of = FROM
						add_core_of = ROOT
						transfer_state_to = ROOT
					}
				}
				ROOT = {
					set_cosmetic_tag = COS_CHL
				}
			}
			#JNG-SCO WAR
			else_if = {
				limit = {
					FROM = {
						tag = SCO
					}
					ROOT = {
						tag = JNG
					}
				}
				FROM = {
					every_core_state = {
						remove_core_of = FROM
						add_core_of = ROOT
						transfer_state_to = ROOT
					}
					every_country = {
						limit = {
							is_in_faction_with = ICE #SCO is not faction leader anymore
						}
						ROOT = {
							puppet = PREV
						}
					}
				}
				JNG = {
					create_faction = "European Front"
					country_event = england_event.22
					set_cosmetic_tag = JNG_britain
				}
			}
			#
			else = {
				#
			}
		}
	}
	###
	on_capitulation_immediate = { #ROOT is looser, FROM is winner
		effect = {
			if = {
				limit = {
					has_global_flag = final_war_flag
				}
				log = "A COUNTRY HAS CAPITULATED!"
			}
			#YUG-ROM WAR
			else_if = {
				limit = {
					ROOT = {
						tag = ROM
					}
					FROM = {
						tag = YUG
					}
				}
				FRA = {
					white_peace = SOV
					white_peace = YUG
				}
			}
			#ROM-YUG WAR
			else_if = {
				limit = {
					ROOT = {
						tag = YUG
					}
					FROM = {
						tag = ROM
					}
				}
				SOV = {
					white_peace = FRA
					white_peace = ROM
				}
			}
			#SWE-NOR WAR
			else_if = {
				limit = {
					ROOT = {
						tag = NOR
					}
					FROM = {
						tag = SWE
					}
				}
				SCO = {
					white_peace = SWE
					white_peace = GER
				}
			}
			#NOR-SWE WAR
			else_if = {
				limit = {
					ROOT = {
						tag = SWE
					}
					FROM = {
						tag = NOR
					}
				}
				GER = {
					white_peace = SCO
					white_peace = NOR
				}
			}
			else = {
				#
			}
		}
	}
}

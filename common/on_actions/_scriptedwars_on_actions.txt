on_actions = {
	on_capitulation_immediate = {
		effect = {
			ROOT = {
				white_peace = FROM
				drop_cosmetic_tag = yes
				if = {
					limit = {
						is_faction_leader = yes
					}
					dismantle_faction = yes
				}
				if = {
					limit = {
						is_in_faction = yes
					}
					leave_faction = yes
				}
				every_subject_country = {
					every_owned_state = {
						limit = {
							OR = {
								is_core_of = FROM
								is_claimed_by = FROM
							}
						}
						transfer_state_to = FROM
					}
					if = {
						limit = {
							FROM = {
								is_puppet = yes
							}
						}
						FROM.OVERLORD = {
							puppet = PREV
							puppet_government_too_PREV = yes
						}
					}
					else = {
						FROM = {
							puppet = PREV
							puppet_government_too_PREV = yes
						}
					}
				}
				every_occupied_country = {
					every_core_state = {
						limit = {
							is_owned_by = ROOT
							if = {
								limit = {
									PREV = {
										exists = yes
									}
								}
								PREV = {
									OR = {
										is_in_faction_with = FROM
										is_puppet_of = FROM
									}
								}								
							}
						}
						transfer_state_to = PREV
					}
					every_owned_state = {
						limit = {
							OR = {
								is_core_of = FROM
								is_claimed_by = FROM
							}
						}
						transfer_state_to = FROM
					}
					if = {
						limit = {
							FROM = {
								is_puppet = yes
							}
						}
						FROM.OVERLORD = {
							puppet = PREV
							puppet_government_too_PREV = yes
						}
					}
					else = {
						FROM = {
							puppet = PREV
							puppet_government_too_PREV = yes
						}
					}
				}
			}
			FROM = {
				if = {
					limit = {
						is_puppet = yes
					}
					OVERLORD = {
						puppet = ROOT
						puppet_government_too = yes
					}
				}
				else = {
					puppet = ROOT
					puppet_government_too = yes
				}
			}
			ROOT = {
				every_owned_state = {
					limit = {
						OR = {
							is_core_of = FROM
							is_claimed_by = FROM
						}
					}
					transfer_state_to = FROM
				}
				if = {
					limit = {
						is_minor_tag = yes
					}
					every_core_state = {
						remove_core_of = ROOT
					}
				}
			}
			FROM = {
				add_to_array = {
					array = global.winning_country
					value = THIS.id
					index = 0
				}
			}
			ROOT = {
				add_to_array = {
					array = global.losing_country
					value = THIS.id
					index = 0
				}
			}
			every_country = {
				limit = {
					is_ai = no
				}
				set_country_flag = country_has_been_defeated
			}
		}
	}
	on_capitulation = {
		effect = {
			ROOT = {
				every_owned_state = {
					transfer_state_to = ROOT
				}
			}
		}
	}
	###
	on_puppet = {
		effect = {
			puppet_government_too = yes
		}
	}
	###
	on_release_as_puppet = {
		effect = {
			puppet_government_too = yes
		}
	}
}

on_actions = {
	#on_war_relation_added = {
	#	effect = {
	#		FROM = { #this is for the notification, defender side, scripted gui
	#			add_to_array = {
	#				array = global.defender_country
	#				value = THIS.id
	#				index = 0
	#			}
	#		} #
	#		ROOT = { #this is for the notification, attacker side, scripted gui
	#			add_to_array = {
	#				array = global.attacker_country
	#				value = THIS.id
	#				index = 0
	#			}
	#		} #
	#		every_country = { #make the notification pop-up
	#			limit = {
	#				is_ai = no
	#			}
	#			set_country_flag = war_has_been_declared
	#		} #
	#	}
	#}
####
	on_capitulation_immediate = {
		effect = {
			balkanize_that = yes #balkanize that! - this is a scripted effect that checks for cosmetic tags of formables, removes cores in occupied states and drops the cosmetic tag, have to be done manually
			ROOT = {
				send_equipment_fraction = {
					value = 0.5
					target = FROM
				}
				every_country = { #this one is for making sure capitulated country allies have a wargoal on the capitulator and do not peace out
					limit = {
						has_war_with = PREV
					}
					every_country = {
						limit = {
							is_in_faction_with = ROOT
							has_war_with = PREV
							NOT = {
								tag = ROOT
							}
						}
						declare_war_on = {
							target = PREV
							type = annex_puppet_wargoal
						}
					}
				} #
			}
			ROOT = { #for some scenarios where small tags or rebellions fight, remove cores when war ends
				if = {
					limit = {
						is_minor_tag = yes
					}
					every_core_state = {
						remove_core_of = PREV
					}
				}
			} #
			FROM = { #this is for the notification, winner side, scripted gui
				add_to_array = {
					array = global.winning_country
					value = THIS.id
					index = 0
				}
			} #
			ROOT = { #this is for the notification, losser side, scripted gui
				add_to_array = {
					array = global.losing_country
					value = THIS.id
					index = 0
				}
			} #
			#every_country = { #make the notification pop-up
			#	limit = {
			#		is_ai = no
			#	}
			#	set_country_flag = country_has_been_defeated
			#} #
			FROM = { #capitulator annexes it all, if an enemy controls any province or state from the capitulated country they will still keep it
				annex_country = {
					target = ROOT
				}
			} #
			random_country = { #checks capitulator or, if puppet, capitulator's overlord
				limit = {
					if = {
						limit = {
							FROM = {
								is_puppet = yes
							}
						}
						tag = FROM.OVERLORD
					}
					else = {
						tag = FROM
					}
				} #
				if = { #here we will release all countries, included capitulated one and those occupied by it
					limit = { #we and our allies are at peace, time to reorg territories
						NOT = {
							any_allied_country = {
								has_war = yes
							}
						}
						has_war = no
					}
					every_country = {
						limit = { #we or our allies...
							OR = {
								is_ally_with = PREV
								tag = PREV
							}
						}
						every_possible_country = {
							limit = {
								any_core_state = { #we or our allies have any core state, but it is not our core
									is_owned_by = PREV.PREV
									NOT = {
										is_core_of = PREV.PREV
									}
								}
								if = {
									limit = { #if the country has already been transfered states make sure it is an ally
										exists = yes
									}
									is_ally_with = PREV
								}
								else = { #else it should't exist
									exists = no
								}
							}
							every_core_state = { #every core state, not core of us, and owned by us, transfer it to the country
								limit = {
									is_owned_by = PREV.PREV
									NOT = {
										is_core_of = PREV.PREV
									}
								}
								transfer_state_to = PREV
							}
							if = { #you just transfered states right? it must exist now... then puppet it
								limit = {
									exists = yes
								}
								random_country = { #again, if you are puppet, your overlord does puppet
									limit = {
										if = {
											limit = {
												PREV.PREV = {
													is_puppet = yes
												}
											}
											tag = PREV.PREV.OVERLORD
										}
										else = {
											tag = PREV.PREV
										}
									}
									puppet = PREV
								}
								puppet_government_too = yes #scripted effect to change country laws too
							}
						}
					}
					every_country = {
						limit = { #we or our allies that are not puppets will get their cores back from puppets
							OR = {
								is_ally_with = PREV
								tag = PREV
								is_puppet = no
							}
						}
						every_country = {
							limit = {
								is_puppet_of = PREV
							}
							every_owned_state = {
								limit = {
									is_core_of = PREV.PREV
								}
								transfer_state_to = PREV.PREV
							}
						}
					}
				}
			}
		}
	}
	on_capitulation = {
		effect = {
			ROOT = {
				if = {
					limit = {
						exists = yes #if it doesn't exist doesn't really matter
					}
					every_owned_state = { #debug, for some reason there is a chance of the effect block making capitulator keep some states controlled
						transfer_state_to = PREV
					}
					FROM = { #if capitulator is in a faction, leader add capitulated country to the faction
						if = {
							limit = {
								is_in_faction = yes
							}
							random_country = {
								limit = {
									is_in_faction_with = PREV
									is_faction_leader = yes
								}
								add_to_faction = ROOT
							}
						}
						if = {
							limit = {
								is_puppet = yes
							}
							FROM.OVERLORD = {
								puppet = ROOT
							}
						}
						else = {
							puppet = ROOT
						}
						puppet_government_too = yes
					}
				}
			}
		}
	}
}

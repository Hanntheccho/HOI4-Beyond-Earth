on_actions = {
	on_startup = {
		effect = {
            set_variable = { devastation_chance = threat }
			#ADDING DYNAMIC MODIFIERS
            every_state = {
				if = {
					limit = {
						OR = {
							state = 949
							state = 113
						}
					}
					add_dynamic_modifier = {
						modifier = notable_devastation
					}
				}
				else_if = {
					limit = {
						is_owned_by = ADU
					}
					add_dynamic_modifier = {
						modifier = terminal_devastation
					}
				}
				else_if = {
					limit = {
						OR = {
							#has_resources_amount = {
							#	resource = oil
							#	amount > 100
							#}
							has_resources_amount = {
								resource = aluminium
								amount > 100
							}
							has_resources_amount = {
								resource = rubber
								amount > 100
							}
							has_resources_amount = {
								resource = tungsten
								amount > 100
							}
							has_resources_amount = {
								resource = steel
								amount > 100
							}
							has_resources_amount = {
								resource = chromium
								amount > 100
							}
							OR = {
								check_variable = {
									building_level@industrial_complex > 5
								}
								check_variable = {
									building_level@arms_factory > 5
								}
							}
						}
					}
					add_dynamic_modifier = {
						modifier = significant_devastation
					}
				}
				else_if = {
					limit = {
						OR = {
							#has_resources_amount = {
							#	resource = oil
							#	amount > 50
							#}
							has_resources_amount = {
								resource = aluminium
								amount > 50
							}
							has_resources_amount = {
								resource = rubber
								amount > 50
							}
							has_resources_amount = {
								resource = tungsten
								amount > 50
							}
							has_resources_amount = {
								resource = steel
								amount > 50
							}
							has_resources_amount = {
								resource = chromium
								amount > 50
							}
							OR = {
								check_variable = {
									building_level@industrial_complex > 2
								}
								check_variable = {
									building_level@arms_factory > 2
								}
							}
						}
					}
					add_dynamic_modifier = {
						modifier = major_devastation
					}
				}
				else_if = {
					limit = {
						OR = {
							#has_resources_amount = {
							#	resource = oil
							#	amount > 10
							#}
							has_resources_amount = {
								resource = aluminium
								amount > 10
							}
							has_resources_amount = {
								resource = rubber
								amount > 10
							}
							has_resources_amount = {
								resource = tungsten
								amount > 10
							}
							has_resources_amount = {
								resource = steel
								amount > 10
							}
							has_resources_amount = {
								resource = chromium
								amount > 10
							}
						}
					}
					add_dynamic_modifier = {
						modifier = notable_devastation
					}
				}
				else = {
					add_dynamic_modifier = {
						modifier = minor_devastation
					}
				}
            }
			###
            every_country = {
                set_variable = { devastation_timeout = 60 }
				calculate_current_devastation = yes
                set_variable = { max_devastation = num_controlled_states }
                multiply_variable = { max_devastation = 4 }
                set_variable = { devastation_modifier = 1 }
                set_variable = { devastation_ratio = ROOT.current_devastation }
                divide_variable = { devastation_ratio = max_devastation }
                #set_variable = { devastation_ratio_new_factory = num_of_civilian_factories }
                #multiply_variable = { devastation_ratio_new_factory = 1.25 }
                #add_to_variable = { devastation_ratio_new_factory = num_of_military_factories }
                #add_to_variable = { devastation_ratio_new_factory = num_of_naval_factories }
				#set_variable = { ROOT.devastation_ratio_new_population = 0 }
				#every_owned_state = {
				#	limit = {
				#		NOT = {
				#			is_core_of = ROOT
				#		}
				#	}
				#	add_to_variable = { ROOT.devastation_ratio_new_population = THIS.state_population_k }
				#}
				#divide_variable = { devastation_ratio_new_population = 4 }
				#add_to_variable = { devastation_ratio_new_population = max_manpower_k }
				#round_variable = devastation_ratio_new_population
				#set_variable = { devastation_ratio_new = devastation_ratio_new_factory }
				#divide_variable = { devastation_ratio_new = devastation_ratio_new_population }
				#round_variable = devastation_ratio_new
				if = {
					limit = {
						all_owned_state = {
							has_dynamic_modifier = {
								modifier = no_devastation
							}
						}
					}
					remove_ideas = mobilizing_society
					remove_ideas = flaking_society
					remove_ideas = crumbling_society
					remove_ideas = periphal_anarchy
					remove_ideas = urban_collapse
					remove_ideas = stable_society
					add_ideas = utopian_society
				}
				else_if = {
					limit = {
						check_variable = { devastation_ratio < 0.11 }
					}
					remove_ideas = mobilizing_society
					remove_ideas = flaking_society
					remove_ideas = crumbling_society
					remove_ideas = periphal_anarchy
					remove_ideas = urban_collapse
					add_ideas = stable_society
				}
				else_if = {
					limit = {
						check_variable = { devastation_ratio < 0.31 }
					}
					remove_ideas = stable_society
					remove_ideas = flaking_society
					remove_ideas = crumbling_society
					remove_ideas = periphal_anarchy
					remove_ideas = urban_collapse
					add_ideas = mobilizing_society
				}
				else_if = {
					limit = {
						check_variable = { devastation_ratio < 0.51 }
					}
					remove_ideas = stable_society
					remove_ideas = mobilizing_society
					remove_ideas = crumbling_society
					remove_ideas = periphal_anarchy
					remove_ideas = urban_collapse
					add_ideas = flaking_society
				}
				else_if = {
					limit = {
						check_variable = { devastation_ratio < 0.71 }
					}
					remove_ideas = stable_society
					remove_ideas = flaking_society
					remove_ideas = mobilizing_society
					remove_ideas = periphal_anarchy
					remove_ideas = urban_collapse
					add_ideas = crumbling_society
				}
				else_if = {
					limit = {
						check_variable = { devastation_ratio < 0.86 }
					}
					remove_ideas = stable_society
					remove_ideas = flaking_society
					remove_ideas = mobilizing_society
					remove_ideas = crumbling_society
					remove_ideas = urban_collapse
					add_ideas = periphal_anarchy
				}
				else = {
					remove_ideas = stable_society
					remove_ideas = flaking_society
					remove_ideas = mobilizing_society
					remove_ideas = crumbling_society
					remove_ideas = periphal_anarchy
					add_ideas = urban_collapse
				}
            }
            #every_state = {
            #    set_variable = { devastation_degree = 3 }
            #}
        }
    }
	on_daily = {
		effect = {
            subtract_from_variable = { devastation_timeout = 1 }
            if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
					    threat < 0.11
                    }
                }
				random_list = {
					5 = {
						increase_devastation_random_state = yes
					}
					95 = {

					}
				}
                add_to_variable = { devastation_timeout = 60 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.21
						threat > 0.10
					}
				}
				random_list = {
					10 = {
						increase_devastation_random_state = yes
					}
					90 = {

					}
				}
                add_to_variable = { devastation_timeout = 60 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.31
						threat > 0.20
					}
				}
				random_list = {
					15 = {
						increase_devastation_random_state = yes
					}
					85 = {

					}
				}
                add_to_variable = { devastation_timeout = 60 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.41
						threat > 0.30
					}
				}
				random_list = {
					20 = {
						increase_devastation_random_state = yes
					}
					80 = {

					}
				}
                add_to_variable = { devastation_timeout = 60 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.51
						threat > 0.40
					}
				}
				random_list = {
					25 = {
						increase_devastation_random_state = yes
					}
					75 = {

					}
				}
                add_to_variable = { devastation_timeout = 30 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.61
						threat > 0.50
					}
				}
				random_list = {
					30 = {
						increase_devastation_random_state = yes
					}
					70 = {

					}
				}
                add_to_variable = { devastation_timeout = 30 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.71
						threat > 0.60
					}
				}
				random_list = {
					35 = {
						increase_devastation_random_state = yes
					}
					65 = {

					}
				}
                add_to_variable = { devastation_timeout = 30 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.81
						threat > 0.70
					}
				}
				random_list = {
					40 = {
						increase_devastation_random_state = yes
					}
					60 = {

					}
				}
                add_to_variable = { devastation_timeout = 20 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat < 0.91
						threat > 0.80
					}
				}
				random_list = {
					45 = {
						increase_devastation_random_state = yes
					}
					55 = {

					}
				}
                add_to_variable = { devastation_timeout = 20 }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { devastation_timeout = 0 }
						threat > 0.9
					}
                }
				random_list = {
					50 = {
						increase_devastation_random_state = yes
					}
					50 = {

					}
				}
                add_to_variable = { devastation_timeout = 20 }
            }
			if = {
				limit = {
					all_owned_state = {
						has_dynamic_modifier = {
							modifier = no_devastation
						}
					}
				}
				remove_ideas = mobilizing_society
				remove_ideas = flaking_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				remove_ideas = stable_society
				add_ideas = utopian_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.11 }
				}
				remove_ideas = mobilizing_society
				remove_ideas = flaking_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = stable_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.31 }
				}
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = mobilizing_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.51 }
				}
				remove_ideas = stable_society
				remove_ideas = mobilizing_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = flaking_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.71 }
				}
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = mobilizing_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = crumbling_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.86 }
				}
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = mobilizing_society
				remove_ideas = crumbling_society
				remove_ideas = urban_collapse
				add_ideas = periphal_anarchy
			}
			else = {
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = mobilizing_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				add_ideas = urban_collapse
			}
        }
    }
	on_weekly = {
		effect = {
			calculate_current_devastation = yes
			clear_variable = max_devastation
            set_variable = { max_devastation = num_controlled_states }
            multiply_variable = { max_devastation = 4 }
            multiply_variable = { devastation_modifier = 5 }
			clear_variable = devastation_ratio
			set_variable = { devastation_ratio = ROOT.current_devastation }
			divide_variable = { devastation_ratio = max_devastation }
			if = {
				limit = {
					all_owned_state = {
						has_dynamic_modifier = {
							modifier = no_devastation
						}
					}
				}
				remove_ideas = mobilizing_society
				remove_ideas = flaking_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				remove_ideas = stable_society
				add_ideas = utopian_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.11 }
				}
				remove_ideas = mobilizing_society
				remove_ideas = flaking_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = stable_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.31 }
				}
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = mobilizing_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.51 }
				}
				remove_ideas = stable_society
				remove_ideas = mobilizing_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = flaking_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.71 }
				}
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = mobilizing_society
				remove_ideas = periphal_anarchy
				remove_ideas = urban_collapse
				add_ideas = crumbling_society
			}
			else_if = {
				limit = {
					check_variable = { devastation_ratio < 0.86 }
				}
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = mobilizing_society
				remove_ideas = crumbling_society
				remove_ideas = urban_collapse
				add_ideas = periphal_anarchy
			}
			else = {
				remove_ideas = stable_society
				remove_ideas = flaking_society
				remove_ideas = mobilizing_society
				remove_ideas = crumbling_society
				remove_ideas = periphal_anarchy
				add_ideas = urban_collapse
			}
		}
	}
	###
	#MONTHLY INCREASING WORLD TENSION
	on_monthly_ADU = {
		effect = {
			if = {
				limit = {
					threat < 1
				}
				set_variable = { global.total_global_devastation = 0 }
				every_state = {
					if = {
						limit = {
							has_dynamic_modifier = {
								modifier = terminal_devastation
							}
						}
						add_to_variable = {
							global.total_global_devastation = 4
						}
					}
					if = {
						limit = {
							has_dynamic_modifier = {
								modifier = significant_devastation
							}
						}
						add_to_variable = {
							global.total_global_devastation = 3
						}
					}
					if = {
						limit = {
							has_dynamic_modifier = {
								modifier = major_devastation
							}
						}
						add_to_variable = {
							global.total_global_devastation = 2
						}
					}
					if = {
						limit = {
							has_dynamic_modifier = {
								modifier = notable_devastation
							}
						}
						add_to_variable = {
							global.total_global_devastation = 1
						}
					}
				}
				divide_variable = { global.total_global_devastation = 1000 }
				random_country = {
					limit = {
						owns_state = 333
					}
					add_named_threat = { 
						threat = global.total_global_devastation
						name = total_global_devastation_added
					}
				}
			}
		}
	}
	###
}
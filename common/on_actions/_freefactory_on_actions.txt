on_actions = {
    on_startup = {
        effect = {
            every_country = {
                set_variable = { free_factory_progress = 0 }
                set_variable = { free_factory_gain = 0 }
                set_variable = { free_factory_base_gain = 1 }
                set_variable = { free_factory_adjustment = 1 }
                set_variable = { free_factory_counter = 0 }
                set_variable = { division_limit = num_of_military_factories }
                multiply_variable = { division_limit = 2 }
                add_ideas = agrarian_stage
                if = {
                    limit = {
                        num_of_factories > 8
                    }
                    add_ideas = developing_stage
                    set_research_slots = 2
                }
                if = {
                    limit = {
                        num_of_factories > 18
                    }
                    add_ideas = developed_stage
                    set_research_slots = 3
                }
                if = {
                    limit = {
                        num_of_factories > 28
                    }
                    add_ideas = regional_stage
                    set_research_slots = 4
                }
                if = {
                    limit = {
                        num_of_factories > 98
                    }
                    add_ideas = continental_stage
                    set_research_slots = 5
                }
                if = {
                    limit = {
                        num_of_factories > 198
                        NOT = {
                            any_country = {
                                check_variable = {
                                    THIS.num_of_factories > ROOT.num_of_factories
                                }
                            }
                        }
                    }
                    add_ideas = global_stage
                    set_research_slots = 6
                }
            }
        }
    }
    on_daily = {
        effect = {
            clear_variable = free_factory_gain
            if = {
                limit = {
                    has_idea = agrarian_stage
                }
                set_variable = { free_factory_base_gain = 0.4 }
            }
            if = {
                limit = {
                    has_idea = developing_stage
                }
                set_variable = { free_factory_base_gain = 0.8 }
            }
            if = {
                limit = {
                    has_idea = developed_stage
                }
                set_variable = { free_factory_base_gain = 1 }
            }
            if = {
                limit = {
                    has_idea = regional_stage
                }
                set_variable = { free_factory_base_gain = 0.6 }
            }
            if = {
                limit = {
                    has_idea = continental_stage
                }
                set_variable = { free_factory_base_gain = 0.4 }
            }
            if = {
                limit = {
                    has_idea = global_stage
                }
                set_variable = { free_factory_base_gain = 0.2 }
            }
            clear_variable = free_factory_adjustment
            set_variable = { free_factory_adjustment = 1 }
            ###
            if = {
                limit = {
                    has_idea = civilian_economy
                }
                multiply_variable = { free_factory_adjustment = 2 }
            }
            if = {
                limit = {
                    has_idea = low_economic_mobilisation
                }
                multiply_variable = { free_factory_adjustment = 1 }
            }
            if = {
                limit = {
                    has_idea = partial_economic_mobilisation
                }
                multiply_variable = { free_factory_adjustment = 0.5 }
            }
            if = {
                limit = {
                    has_idea = war_economy
                }
                multiply_variable = { free_factory_adjustment = 0.1 }
            }
            ###
            if = {
                limit = {
                    has_idea = mobilizing_society
                }
                multiply_variable = { free_factory_adjustment = 0.95 }
            }
            if = {
                limit = {
                    has_idea = flaking_society
                }
                multiply_variable = { free_factory_adjustment = 0.9 }
            }
            if = {
                limit = {
                    has_idea = crumbling_society
                }
                multiply_variable = { free_factory_adjustment = 0.8 }
            }
            if = {
                limit = {
                    has_idea = periphal_anarchy
                }
                multiply_variable = { free_factory_adjustment = 0.6 }
            }
            ###
            if = {
                limit = {
                    has_tech = corporate_model
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
            }
            if = {
                limit = {
                    has_tech = corporate_model_II
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
            }
            if = {
                limit = {
                    has_tech = corporate_model_III
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
            }
            if = {
                limit = {
                    has_tech = corporate_model_IV
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
            }
            if = {
                limit = {
                    has_tech = corporate_model_V
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
            }
            if = {
                limit = {
                    has_idea = industry_resolution_idea1
                }
                multiply_variable = { free_factory_adjustment = 1.05 }
            }
            if = {
                limit = {
                    has_idea = industry_resolution_idea2
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
            }
            if = {
                limit = {
                    has_idea = industry_resolution_idea3
                }
                multiply_variable = { free_factory_adjustment = 1.15 }
            }
            if = {
                limit = {
                    has_idea = industry_resolution_idea4
                }
                multiply_variable = { free_factory_adjustment = 1.2 }
            }
            if = {
                limit = {
                    has_idea = industry_resolution_idea5
                }
                multiply_variable = { free_factory_adjustment = 1.25 }
            }
            if = {
                limit = {
                    has_idea = ecobalance_resolution_idea2
                }
                multiply_variable = { free_factory_adjustment = 0.95 }
            }
            if = {
                limit = {
                    has_idea = PUN_earths_gaping_wound
                }
                multiply_variable = { free_factory_adjustment = 0.1 }
            }
            if = {
                limit = {
                    has_idea = BNG_the_dam
                }
                multiply_variable = { free_factory_adjustment = 0.1 }
            }
            if = {
                limit = {
                    has_idea = KAV_delhi_super_slum
                }
                multiply_variable = { free_factory_adjustment = 0.75 }
            }
            if = {
                limit = {
                    has_idea = PER_humiliation
                }
                multiply_variable = { free_factory_adjustment = 0.8 }
            }
            if = {
                limit = {
                    has_idea = PER_winning_minds_not_hearts
                }
                multiply_variable = { free_factory_adjustment = 0.9 }
            }
            if = {
                limit = {
                    has_idea = PRU_the_lithium_business
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
            }
            if = {
				limit = { 
                    has_idea = ENG_the_sick_man_of_britannia
                }
                multiply_variable = { free_factory_adjustment = 0.9 }
			}
            if = {
				limit = { 
                    has_idea = JAP_hikaemena_dairiten
                }
                multiply_variable = { free_factory_adjustment = 1.2 }
			}
            if = {
				limit = { 
                    has_idea = TRE_absence_of_civilization
                }
                multiply_variable = { free_factory_adjustment = 0.1 }
			}
            if = {
				limit = { 
                    has_idea = CIN_last_bastion_of_american_prosperity
                }
                multiply_variable = { free_factory_adjustment = 1.1 }
			}
            #if = {
            #    limit = {
            #        has_idea = uafs
            #    }
            #    multiply_variable = { free_factory_adjustment = 1.15 }
            #}
            if = {
                limit = {
                    has_idea = KAZ_apple_asia
                }
                multiply_variable = { free_factory_adjustment = 1.05 }
            }
            add_to_variable = { free_factory_gain = free_factory_base_gain }
            multiply_variable = { free_factory_gain = free_factory_adjustment }
            add_to_variable = { free_factory_progress = free_factory_gain }
            if = {
                limit = {
                    check_variable = { free_factory_progress > 100 }
                    any_state = {
                        is_fully_controlled_by = ROOT
                        free_building_slots = {
                            building = industrial_complex
                            size > 1
                            include_locked = no
                        }
                    }
                }
                add_to_variable = { free_factory_counter = 1 }
                random_list = {
                    50 = {
                        random_owned_controlled_state = {
                            limit = {
                                is_fully_controlled_by = ROOT
                                free_building_slots = {
                                    building = industrial_complex
                                    size > 1
                                    include_locked = no
                                }
                            }
                            add_building_construction = {
                                type = industrial_complex
                                level = 1
                                instant_build = yes
                            }
                        }
                    }
                    50 = {
                        random_owned_controlled_state = {
                            limit = {
                                is_fully_controlled_by = ROOT
                                free_building_slots = {
                                    building = arms_factory
                                    size > 1
                                    include_locked = no
                                }
                            }
                            add_building_construction = {
                                type = arms_factory
                                level = 1
                                instant_build = yes
                            }
                        }
                    }
                }
            }
            if = {
                limit = {
                    check_variable = { free_factory_progress > 100 }
                }
                clear_variable = free_factory_progress
                set_variable = { free_factory_progress = 0 }
            }
        }
    }

    on_daily = {
        effect = {
            set_variable = { division_limit = num_of_military_factories }
            multiply_variable = { division_limit = 2 }
            round_variable = division_limit
            if = {
                limit = {
                    check_variable = { num_divisions > division_limit }
                }
                clear_variable = too_many_divs_var
            	set_variable = { too_many_divs_var = num_divisions }
            	divide_variable = { too_many_divs_var = division_limit }
                divide_variable = { too_many_divs_var = 20 }
                multiply_variable = { too_many_divs_var = -1 }
                add_dynamic_modifier = {
                    modifier = too_many_divs
                }
            }
            else_if = {
                limit = {
                    AND = {
                        check_variable = { num_divisions < division_limit }
                        has_dynamic_modifier = { modifier = too_many_divs }
                    }
                }
                clear_variable = too_many_divs_var
                remove_dynamic_modifier = {
                    modifier = too_many_divs
                }
            }
        }
    }

    on_daily = {
        effect = {
            if = {
                limit = {
                    num_of_factories > 8
                    NOT = { num_of_factories > 18 }
                }
                add_ideas = developing_stage
                set_research_slots = 2
            }
            else_if = {
                limit = {
                    num_of_factories > 18
                    NOT = { num_of_factories > 28 }
                }
                add_ideas = developed_stage
                set_research_slots = 3
            }
            else_if = {
                limit = {
                    num_of_factories > 28
                    NOT = { num_of_factories > 98 }
                }
                add_ideas = regional_stage
                set_research_slots = 4
            }
            else_if = {
                limit = {
                    num_of_factories > 98
                    NOT = { num_of_factories > 198 }
                }
                add_ideas = continental_stage
                set_research_slots = 5
            }
            else_if = {
                limit = {
                    num_of_factories > 198
                    NOT = {
                        any_country = {
                            check_variable = {
                                num_of_factories > ROOT.num_of_factories
                            }
                        }
                    }
                }
                add_ideas = global_stage
                set_research_slots = 6
                add_to_array = {
                    array = global.global_superpower_title_array
                    value = THIS.id
                    index = 0
                }
            }
            else = {
                add_ideas = agrarian_stage
                set_research_slots = 1
            } 
        }
    }
}